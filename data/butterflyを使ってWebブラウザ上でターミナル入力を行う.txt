<p><a href="http://paradoxxxzero.github.io/2014/02/28/butterfly.html" rel="nofollow" title="" class="ext-link">butterfly your everyday terminal in your web browser</a> by <a href="https://github.com/paradoxxxzero" rel="nofollow" title="" class="ext-link">Florian Mounier</a></p><p>今回は、最近ハマっているものを紹介します。最初は遊びで作り始めたのですが、今では毎日使うようになってしまいました。それがこれです。</p><p><img src="/wp/wp-content/uploads/2014/03/1.gif" alt='"butterfly screen cast"'></p><p>この<b>butterfly</b>を使えば、Webブラウザ上でターミナル入力を行うことができます。</p><p>まずは試してみてください。下記の通り、インストールは簡単。</p><p>終わったら、ブラウザで<a href="http://localhost:57575/" rel="nofollow" title="" class="ext-link">localhost:57575</a>にアクセスするだけです。</p><p>butterflyはバックグラウンドで稼働するサーバに依存するため、systemdの設定が必要です。次のリンクから<a href="https://raw.github.com/paradoxxxzero/butterfly/master/butterfly.service" rel="nofollow" title="" class="ext-link">butterfly.service</a>ファイルをダウンロードして、<code>/etc/systemd/system/</code>もしくは同等のディレクトリに保存してください。次に、下記のコマンドを実行します。</p><p>これで、常にサーバが稼働した状態となります。</p><p>butterflyはターミナルユーザもしくはrootユーザで実行できるように設計されています。rootで実行した場合、権限は接続を開始したユーザ、つまりWebページを開いたユーザに移ります。ターミナルユーザは<a href="http://localhost:57575/user/user" rel="nofollow" title="" class="ext-link">localhost:57575/user/<user></user></a>で変更可能です。</p><p><code>butterfly.server.py --host="0.0.0.0"</code>を実行しホスト名に”0.0.0.0″をバインドすれば、他のユーザにターミナルへの接続権限を与えることができます。ただしアクセス時にパスワードの入力が求められるものの、セキュリティ対策は万全ではないので注意が必要です。現時点ではあくまでもテスト仕様ということで、ローカルネットワーク内の運用にとどめておいてください。</p><p><b>シェル</b>の実行は<code>butterfly.server.py --shell=/bin/fish</code>のようにオプションを使って行います。</p><p>butterflyは他のターミナルと同じように動作しますが、いくつか特徴的な機能があります。</p><p>ターミナルにフォーカスが当たっている時はショートカットキーが効かないため（ブラウザ指定のものは除く）、例えば<b> CTRL + L </b>を押してもアドレスバーに移動しません。それではどうするのかというと、最初に<b> ALT + Z </b>を押してやります。これでbutterflyに「次の組み合わせはショートカットキーですよ」ということを教えてやるのです。つまり、アドレスバーに移動するには、最初に<b> ALT + Z </b>、そして<b> CTRL + L </b>を押せばいいわけですね（ブラウザがCSS3フィルタをサポートしていれば、画面がセピア色に変わるはずです）。</p><p>私がターミナルを使っていて常々欲しいなと思っていた機能、それがこの「テキストのクイック選択」です。どういうものか、説明するより実際にやってみましょう。まず<b> CTRL + SHIFT + up </b>を押して選択機能をONにします。次に<b> CTRL + SHIFT + up/down </b>でターミナル上のテキストを選択。最後にENTERを押すと、butterflyが選択されたテキストをプロンプトに反映してくれます。</p><p><img src="/wp/wp-content/uploads/2014/03/2.gif" alt='"butterfly selection"'></p><p><img src="/wp/wp-content/uploads/2014/03/3.gif" alt='"butterfly modern editors"'></p><p>・メモリを食うため、スクロールバックは今のところ100,000行までです。将来的には、サーバがスクロールバックをディスクに書き込むよう修正するのもいいかもしれません。<br>
・ターミナル内へのhtmlの埋め込みは可能ですが、<code>ESC]99;&lt;html&gt;BELL</code>コマンドでの部分的なサポートになります。ちなみに、これを活用すれば<a href="https://github.com/paradoxxxzero/butterfly/tree/master/bin" rel="nofollow" title="" class="ext-link">面白い機能</a>が実現できるはずです。<br>
・1670万色には未対応ですが、<code>ESC[38;2;r;g;bm</code>を使えばかなり近いところまで持っていけるのではと思います。<br>
・ターミナル上でCSS/jsファイルを編集するオプションには、テーマと拡張機能のパッケージリポジトリがありません。</p><p><a href="https://github.com/paradoxxxzero/butterfly" rel="nofollow" title="" class="ext-link">リポジトリはgithubにアップされています。</a></p><p>個人的には、とにかく実装が楽しかったです。皆さんのコメントをお待ちしています。</p>
