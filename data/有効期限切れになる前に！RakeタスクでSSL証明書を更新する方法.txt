<p><a href="https://www.petekeen.net/know-how-to-roll-your-ssl-certificates" rel="nofollow" title="" class="ext-link">Know How To Roll (Your SSL Certificates)</a> by <a href="https://twitter.com/zrail" rel="nofollow" title="" class="ext-link">Pete Keen</a></p><p>数週間前に、他の主要なサイトの証明書と一緒に<a href="https://twitter.com/stripestatus/status/493137783595073537" rel="nofollow" title="" class="ext-link">StripeのSSL証明書が無効になりました</a>。<em>それらのサイト</em>の証明書が有効期限切れになったわけではなく、認証局のルート証明書の有効期限が切れてしまったのです。これは起こってはならないことですが、他の恐ろしいことがそうであるように、起こってほしくないときにむしろ発生してしまうものです。</p><p>サービスプロバイダの証明書が有効期限切れになることに対しては、それを防ぐための対策として自分でできることはあまりありません。しかし、自分の証明書が有効期限切れになることに対しては前もって対策を立てることができます。大きなポイントとしては、スケジュールとプロセスを確立することです。</p><p>これは簡単にできます。”SSL証明書をチェックする”というカレンダエントリが毎月自動更新されるように設定するだけです。そしてカレンダエントリが上がってきたら、自分のWebサイトに行き、鍵のアイコンをクリックして証明書をチェックします。チェック項目を以下に挙げておきましょう。</p><p>これはSSL証明書を1つ持っているとしたらやるべき最小限のことです。もし2つ以上の証明書を持っていたり、もっと何か対策を行いたいと思っていたりする場合は、世の中にはいくらでも無料のそして有料のSSLモニタリングサービスがありますので、そのようなサービスを使えば、証明書に問題がないかどうかを四六時中チェックすることができます。</p><p>証明書を更新するためのプロセスは、多少なりともインフラストラクチャに依存します。しかし、一般的な考え方は変わりません。</p><p>証明書を更新する際は、あなたの知らないところで秘密鍵が漏洩しているかもしれないので、毎回新たな秘密鍵を使うべきだということに気をつけましょう。さらに詳しく知りたい場合は、「<a href="https://www.ssllabs.com/downloads/SSL_TLS_Deployment_Best_Practices_1.3.pdf" rel="nofollow" title="" class="ext-link">SSL LabによるSSL／TLSデプロイメントのベストプラクティス</a>」（pdf）を読んでみてください。</p><p>Herokuを使っていて、このようなことが非常に面倒に思う場合は、<a href="https://www.expeditedssl.com/" rel="nofollow" title="" class="ext-link">ExpeditedSSLのアドオン</a>をチェックしてみることをお勧めします。私が挙げたような手順をすべて自動化し、SSLの状態を保つことができますよ。</p><p>私は自分のサイト全てをVPS上で運営していますので、あらゆることを自分自身で管理できるという特権があります。そこで、覚えるのが難しい手順を私の代わりに管理してくれるRakefileをまとめました。鍵や証明書と同様にプライベートなソース管理の領域に置いてありますが、今のところ以下のような感じになっています。</p><p>とてもシンプルな仕組みです。ここでやっていることは完全に適格なドメイン名を入力し鍵とCSRを出力するということだけです。使えるものがあれば、すでに存在している鍵を再利用します。クリップボードにCSRをコピーする機能があるので、プロバイダのWebサイトにペーストするだけでいいのは便利です。</p><p>証明書のインストールは、インフラストラクチャに依存します。Herokuには、Amazonと同様に、いい指針があります。Nginxを使っているのであれば、自分の証明書や中間証明書からPEMファイルを生成する必要があります。上記のRakefileにはassemble_certという名のタスクがあり、Nginxに適したPEMファイルを構築することができるのです。</p><p><b>非常に重要な注意：</b>証明書をまとめる時に順序性が必要になりますが、その順序性を反映させるため、assemble_certのタスクの変更は確実に行ってください。このスクリプトはNamecheapが発行したComodoの証明書に対しては正しいファイルを生成しますが、他の認証プロバイダでも使えるかどうかの保証はありません。</p>
