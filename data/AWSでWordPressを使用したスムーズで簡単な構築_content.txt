WordPress on AWS smooth and pain free(2016-10-31) by Andreas Wittig『Amazon Web Services in Action』の著者。ソフトウェアエンジニア。AWSとDevOpsに重点的に取り組むフリーのコンサルタントでもある。WordPressはクラウド・レディでもサーバレスでもないので、私はあまり好きではありません。このブログはCloudFrontとS3を使用し、Hexoで構築しています。しかし、なんとWebサイトの25％がWordPressを使って作成されているのです。そこで、AWSでWordPressを構築する最も簡単な方法を説明します。フォールトトレランスとスケーラビリティを含んだ内容です。次の図は、AWS上でフォールトトレラントかつスケーラブルなWordPress環境を構築する際のアーキテクチャを表しています。
注釈：Elastic File System（EFS）
MySQL（マスター）
MySQL（スタンバイ）
WordPressを実行するEC2インスタンス
ロードバランサ
CDN詳しく見ていきましょう。WordPressは、MySQLのデータベースとディスク上のファイルという2つの異なるデータストレージを使用するPHPアプリケーションです。ファイルをディスク上に保存すると、EC2インスタンス群を使用してフォールトトレラントかつスケーラブルな方法でWordPressを実行する場合に問題が生じます。次の例と図は、その問題点を表したものです。
面倒なことに、全てのEC2インスタンスでファイルを同期させるか、マネージドサービスにファイルをアウトソースしなくてはいけません。私は以前、AWSでWordPressを使う際に生じるこの問題を解決しようと試みました。『AWSでWordPressを使用する：あなたの間違った使い方』という記事に、解決策の詳細が載っています。簡単に要約すると、以下のようなものです。しかし、プラグインとテーマのインストール機能や、自動更新機能が使えないのは不便です。Elastic File System（EFS）は2016年にAWSのサービスに追加されました。
EFSは高可用性のスケーラブルなネットワークファイルシステムで、NFSプロトコルを使用してEC2インスタンスに接続できます。ファイルをアウトソースするには完璧な場所です。次の図は、WordPressを実行する各EC2インスタンスが、どのようにEFSに接続してファイルを読み書きするかを表しています。ユーザがアップロードするものと、WordPressのファイルを区別する必要はありません。
注釈：Elastic File System（EFS）
EC2インスタンス群EC2インスタンスがEFSからファイルを読み込む際は毎回ネットワーク呼び出しが必要なので、ファイルのキャッシュが重要です。特に.phpファイルの場合はそうです。WordPressはリクエストの度に、多くの.phpファイルにアクセスする必要があるからです。OPcacheを使えば、すぐに解決できるでしょう。同様に、静的ファイルのキャッシュも必要になります。WordPressのブログの訪問者は、それぞれ同じ.cssファイルや.jsファイルを読み込まなければいけないので、CloudFrontのようなCDNが最適です。これらのサービスに基づいた、AWS上のWordPressのアーキテクチャ完成図は次のようになります。
注釈：Elastic File System（EFS）
MySQL（マスター）
MySQL（スタンバイ）
WordPressを実行するEC2インスタンス
ロードバランサ
CDN上記で説明したように、EFSを使用してAWSでWordPressを使いたいですか？ 私はCloudFormationのテンプレートを作成しました。次に挙げる特徴を含んだ、求められるクラウドインフラストラクチャの構築が数分で行えます。AWSでWordPressを使うためのCloudFormationのテンプレートについて詳しく知り、数分でスタックをローンチしてみてください。以下の書籍と記事をお薦めします。
