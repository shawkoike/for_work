<p><a href="https://medium.com/@fat/mediums-css-is-actually-pretty-fucking-good-b8e2a6c78b06" rel="nofollow" title="" class="ext-link">Medium’s CSS is actually pretty f***ing good.</a> （2014-08-28）by <a href="http://byfat.xxx/" rel="nofollow" title="" class="ext-link">fat</a></p><p><img src="https://d262ilb51hltx0.cloudfront.net/max/657/1*NUIBLEV519p658NgXIFPyg.png" class="aligncenter"></p><p>ずっと長いこと恥も外聞も知らずに、MediumでCSSについて執筆しようと思っていました…。</p><p>それからどうなったって？　違うことをやっていた？　何てこと、どうやったら同じことができるかって？　やり方を教わりたいって？</p><p>これから書くことは私たちのCSSについての覚書で、これまでに歩んできた道のりと現在のCSSについて述べています。</p><p>だいたい2年ほど前、私はソフトウェアアプリケーション開発と（皆さんが読んでくれているといいのですが）<em>medium.com</em>に取り組むためにObvious Corp.に加わりました。</p><p>その時、Mediumは、すでに一連の”スタイル更新”を行っていました（<em>スタイル更新とは<br>
デザイナが過去に考え出したものよりも、より勝るものを思いついたことで、結果的に、CSS/LESS/SASSなどを書き直すということです</em>）。スタイル更新が原因で、古いものが多く生み出されることになり、同社は、ページを運用するセマンティクスや、Spriteされていない/Retinaに対応していない画像アセットやそれ以外のものにおいて、LESSの言語的機能に偏っていました。</p><p>私はgitを使って、何とか2012年（ゾッとしますね）まで、さかのぼったプロフィールページを引き戻すことに成功しました。以下を見てみれば、やりきれないパターンに気づくと思います。</p><p>当時、私はライブラリコード（Bootstrap、Ratchetなど）に取り組んでいて、可能な限り最高のCSSを記述しようと全力を注いでいました。<br>
MediumのCSSは明らかに違っていました。何とかなるレベルの違いではなく、壊滅的な違いがそこにはありました。私はそれを直したかったのです。<br>
全体を見て、最初に私が取り組んだのは画像でした。私たちが2012年に、Spriteを何も施していなかったことにかなり愕然としたのを、私は覚えています…。蓄積された何百という画像アセット、例えばプレースホルダ、矢印、アイコンなど、まるでアイコンの墓場のように/img/ディレクトリがあふれていました。<br>
そんな現状を打開するために、私は2つのことをしました。1つ目はSUSと呼ばれる、ちょっとしたCSSのユーティリティスクリプトを書きました（SUSは今でも使っているので、ここでオープンソースが手に入ります（<a href="https://github.com/medium/sus" rel="nofollow" title="" class="ext-link">https://github.com/medium/sus</a>）。これはGuillermo Rauchの助けを借りて主にIRCで書かれたものです。スタイルシートから画像を抽出して、それを独立したdata-uriファイルで遅延読み込みするために使用します。オリジナルコンセプトではなく、私たちが目指す方向へ進むための手助けとなり得るシンプルなコンセプトです。<br>
<img src="https://d262ilb51hltx0.cloudfront.net/max/734/1*6IeCB0lIPZ7HqZkl8ZYfDw.png" class="aligncenter"></p><p>2つ目はGeoff Teehanと私が腰を落ち着けて、Mediumの最初のアイコンフォントを作成したことです。当時、私たちは何をすべきか、全く分かりませんでした…。しかしIcoMoon、GitHubについて書かれたブログからヒントを受け、長い夜を過ごした後、私たちは、なかなかいいMediumアイコンを作成できたのです。これは大きな意味を持ちました。というのも、私たちはimgフォルダのほぼ97％を削除したのです。フォントは私のMacBook Pro Retinaディスプレイモデルでの見栄えもばっちりでしたし、使うリソースを大幅に減らせるようになりました。</p><p>次の主要なプロジェクトは、z-indexスケールでした。z-indexは、すぐに手に負えなくなり、常にイライラさせられる曲者です。Mediumでは同じであってほしくありませんでした。</p><p>このプロジェクトが始まる前は、ある要素が<b>z-index: 5</b>で、隣の要素は<b>z-index: 1000000; </b>、さらに<b>z-index: 1000001; </b>や<b>z-index: 99999; </b>の要素もあるといった状況は実によく目にしました。</p><p>こうしたスタイルはコードベースの至る所で使われており、これらをソートするための名案は思い浮かびませんでした。</p><p>そのため、私はz-indexの値についてコードベース全体を手作業で調べるという骨の折れる仕事を行うことにしました。それから、コンポーネントにz-index（1～10に限定）を付ける時に用いるプライベートなスケール（z-index.lessの中でのみ有効）を導入しました。そして最終的に、このスケールによる実際の割り当てをすべてz-index.lessの中に移したため、さまざまなコンポーネントが互いにどのように位置付けられているかが分かるようになりました（これは実際、かなり便利です）。</p><p>下記は現在medium.comで使っているz-indexファイルです（訳注:gistリンク）。<br>
<!--<script src="https://gist.github.com/fat/1f6da6b3bd0311a1f8a0.js"></script>--><br>
<a href="https://gist.github.com/fat/1f6da6b3bd0311a1f8a0" rel="nofollow" title="" class="ext-link">https://gist.github.com/fat/1f6da6b3bd0311a1f8a0</a></p><p>もちろん、このz-indexスケールの次にはすぐ、カラースケール（ブラック、グレー、ホワイト、ブランドカラーなどに対する変数）やタイプスケール（フォントサイズ、太さ、文字間隔、行の高さなどに対する変数）を定めました。</p><p>また、変数名がより厳密でセマンティックになっていることに気づくかもしれません。この点については後述します。</p><p>Mediumにスケールを導入して程なく、私たちは新たなスタイルのコード”Cocoon”を作るという大きな作業に取り掛かりました。</p><p>Cocoonでは、いくつかの投稿テンプレート（Mediumにはもともと、単一の記事テンプレートだけでなく、画像テンプレートや引用テンプレートもありました）を旧式とし、投稿”カード”の代わりに投稿リストの仕組みも導入しました。</p><p><img src="https://d262ilb51hltx0.cloudfront.net/max/473/1*SS66DN_n9CSJxLFXezG6pw.png" class="aligncenter"></p><p>私たちはこれを、一歩下がってMediumの新たなスタイルガイドを作る機会だと捉えたのです。</p><p>このことに初めに取り組んだのは、私とDave Gamache、Dustin Senos、そして有能なChris Erwinでした。</p><p>私たちは、Mediumで実際のCSSやLESSを書くということに関して、考えを固めるのに時間をかけました。主に更新した点は次のとおりです。</p><p>以下に全体を掲載します（訳注：gistリンク）。<br>
<!--<script src="https://gist.github.com/fat/b27700946c777adacdf4.js"></script>--><br>
<a href="https://gist.github.com/fat/b27700946c777adacdf4" rel="nofollow" title="" class="ext-link">https://gist.github.com/fat/b27700946c777adacdf4</a></p><p>決して完全ではありませんが、いくつかの基本概念を整理し、正しいと感じられる方向を示す指針となりました。</p><p>ですが残念ながら、このスタイルの更新のあとでさえ、いつコンポーネントを作るべきか、いつサブコンポーネントを作るべきか、といったことを考えるのに人々は苦労しているようでした。そして時々、目的のはっきりせず、単語を連ねただけの. <b>nav-on-light-background-button</b>や. <b>button-primary-sidebar-over-blur</b>のようなクラス名が付けられていました。</p><p>ページレベルでクラスにプレフィックスが付けられることはなくなりました（これは素晴らしいことです）が、その代わりに、任意の単語がダッシュで長々とつなぎ合わされるようになりました。例えば、. <b>button</b> → . <b>button-primary</b> → . <b>button-primary-dark</b> → . <b>button-primary-dark-container</b> → . <b>button-primary-dark-container-label</b>のように、うんざりするほど名前が長くなっていくのです。</p><p>大体この頃、世界一になるんだという壮大な目標を持って、私はCSSについて実にたくさんのことをMediumの内部で書き始めました。それが何を意味するのか本当はあまり分かっていませんでしたが、私たちのその時の方向性がどうもうまくいっていないことは分かっていました。</p><p><em>人々は困惑していました。さらに悪いことには、実際はそうでないにもかかわらず、みんな自分はとてもうまくCSSを書いていると思っていたのです。</em></p><p>そこで、私はいろいろ見てみることにしました。フレームワークを探したり、さまざまなツールを試したり、理念について調べたり、友人と話をしたり、友人の友人と話をしたりしました。そしてまもなく、私たちのCSSを望ましいと思われる形に変えるためには、主に3つのプロジェクトに取り組む必要があると特定したのです。</p><p>コードベースにおいてセマンティクスをより厳密にしたいと思いました。なぜなら、私たちのチームの規模では、そうすることで基礎となるルールを作るのがより簡単になると感じたからです。また、人々が新しいCSSのクラスを作る時に、より気を配らなくてはならなくなるとしても、やや複雑にしたほうが良いと思いました。何が何でも長々と続くクラス名をなくしたいと考えていましたが、それができなくてもせめて作りにくくはしたかったです。</p><p>このことについてDaryl Koopersmithと良き友人であるNicolas Gallagherと詳しく話しました。</p><p><img src="https://d262ilb51hltx0.cloudfront.net/max/677/1*hb8QPaKB3q4lNzSIRJ6suQ.png" class="aligncenter"></p><p>Nicolasと私にはおもしろい交友関係があります。Nicolasが私に言う事に対して私は間違ってると反論し、フランス語で悪口を言うんです（馬鹿や間抜けなど）。そして数週間そのことについて避けていたら、私は必ず彼は間違っていなかったと気づきます。そして彼のアイディアを自分のものにするんです。</p><p>今回も同じでした。数日後、最終的にNicolasが<a href="https://github.com/suitcss" rel="nofollow" title="" class="ext-link">SUITCSS</a>で書いたものと似たスタイルを使うのが良いと確信しました。似ているけどわずかにですが、より優れたものです。</p><p>そこで私はNicolasを徹底的に参考にすることから始めました。古いスタイルガイドを捨て、彼が書いたものを大量にコピーしあちこちを少しずつ編集したんです。</p><p>そうして今のスタイルガイドが完成したのです。以下に全体を示しますが、主に付け加えたものです。</p><p><!--<script src="https://gist.github.com/fat/a47b882eb5f84293c4ed.js"></script>--><br>
<a href="https://gist.github.com/fat/a47b882eb5f84293c4ed" rel="nofollow" title="" class="ext-link">https://gist.github.com/fat/a47b882eb5f84293c4ed</a></p><p>スタイルガイドをコピーして貼り付けるやり方とCSSアプリケーションをすべてリライトするやり方は別物です。</p><p>ただ自己満足したいという気持ちもありましたが、ありがたいことに、このプロジェクトの重要性を会社に納得してもらうことができました。そしてMedium.comのCSSをリライトするために2週間半が与えられました。これは以前ブログにも書いた<a href="https://medium.com/designing-medium/crafting-link-underlines-on-medium-7c03a9274f9" rel="nofollow" title="" class="ext-link">CSSの下線を直すプロジェクト</a>に掛けた時間よりも短い期間でした。</p><p>このリライトはただCSSのコードをきれいにするだけでなく、大量にある古いスタイルの排除やサイト全体にわたる実装の効率化と一般化、ファイルのサブコンポーネント単位への細分化を行います。そして、驚くことにわずかなロールバックしか起こさないのです。</p><p>もちろんCSSのリファクタリングはテンプレートのリファクタリングにもなります。全面的にカプセル化や厳密なセマンティクスを増やします。今日では、例えばランダムなavatarクラスでたった1度しか機能しない大量の<code>&lt;IMG&gt;</code>タグを使用するより、1つにまとめたavatarテンプレートを使用する方がやりやすくなります。その方法はサイズやスタイルなどの異なる修飾子をbooleanオプションを受け取って使用します。こうすることでスタイルの更新が簡単になり、実装してからバグが発生する頻度が下がります。</p><p>間違いなく2年前より環境が良くなりました。MediumでCSSを書くのは実際にとても楽しいですし、開発者は様々な経験を得て素晴らしい製品をいくつも開発しています。</p><p>次のCSSプロジェクトはパフォーマンスについてになるでしょう。私たちはプロジェクトの新たなページを刻み続け、次の段階へと進めていきます。なんとも正確で信頼性の高いレイアウトを測定するツールを想像してみてください。そしてレンダリングのパフォーマンスは非常に重要です。しかし残念ながら2014年の現在ではまだ完成していません。</p><p>なので、まだまだやることはたくさんありますが、今のところはとても気分がいいです。それもいつも以上にです。</p><p>こんな長くてつまらない投稿を最後まで読んでくれてありがとうございます。</p><p>Katie、Dave、Mark、Koop、Kristopher、Nicolasそしてプロジェクト（そしてMediumのCSSを直すこと）をおそらく意識していなかったでしょうが手助けしてくれた方々に感謝を述べます。</p>
