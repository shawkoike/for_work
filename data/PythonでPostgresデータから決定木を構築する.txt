<p><a href="http://www.garysieling.com/blog/building-decision-tree-python-postgres-data" rel="nofollow" title="" class="ext-link">Building a Decision Tree in Python from Postgres data</a> by <a href="https://twitter.com/garysieling" rel="nofollow" title="" class="ext-link">Gary Sieling</a></p><p>今回は、任意の人物の所得を人口統計データを使って予測する手法をご紹介します。使用するのは<a href="http://archive.ics.uci.edu/ml/machine-learning-databases/adult/" rel="nofollow" title="" class="ext-link">20年前の人口統計データ</a>です。</p><p>この例を用いて、関係データベースの情報から予測モデルを導き出す方法と、その途中で起こり得るトラブルについて触れたいと思います。</p><p>このデータの優れた点は、データの作成者が下記のようなアルゴリズムの精度をデータに添付している点です。こうした数値はスモークテストの結果評価に役立ちます。</p><p></p><p></p><p>このデータセットをPostgresのデータベースに読み込むには、まずデータ作成者のファイルの一番下にある空白行と「1×0 Cross Validator」と書かれた行を削除する必要があります。</p><p>次に、下記の手法でデータを読み込みます。テストデータも同じPostgresデータベースにロードしていますが、そこは気にしないでください。</p><p>ご覧の通り、PostgresではUNCパスを指定することができます。特筆するほどのことではないと思われるかもしれませんが、VisualStudioではUNCパスを読み込むことができないことを考えると、うれしい機能ではないでしょうか。</p><p></p><p></p><p>Pythonの場合、こうしたデータならSQLAlchemyを使っても読み込むことができます。ただしPostgresドライバ（”pg8000″）は不安定なため、たまに次のようなエラーが起こる場合があります。</p><p></p><p></p><p><del>エラーの原因はさまざまですが、そのひとつとしてPostgresの旧バージョンを使用しているケースが考えられます (著者は9.3を使用しました)。旧バージョンには閉じているカーソルのデータが読み込まれてしまうという問題もあるようです。</del></p><p></p><p></p><p>大量のデータを処理する場合、クエリの結果をモデルの中にストリーム処理する手法はとても有効です。ただし今回はデータサイズが小さいので、ストリーム処理は行いませんでした。また、ひとつの表に全データが入っている場合には、効率よくデータ処理ができるよう、任意にデータを半分に分割する方法を考えなければならないでしょう。</p><p></p><p></p><p>このデータには、もともとテキスト型の列と整数型の列が混ざって入っていました（職業と年齢など）。意外にもPythonの機械学習ライブラリは、このような混合データの認識が苦手なようです（少なくともディシジョンツリーは苦手です）。こうしたデータは一連のvalue値のみで構成されたデータとはまったく別物なので、特別な配慮が必要になります。</p><p>問題は、ライブラリがvalue値のリストを期待しているにも関わらず元データが数値型である、というケースです。この問題を解決するには、次のようなマッピングを行うグローバルな辞書の構築が必要になるでしょう。</p><p></p><p></p><p>ここで、属性を2つに分割しなければなりません。ひとつは出力に、もうひとつは出力を予測するための属性に分割します。</p><p></p><p></p><p>この事例で最も注目すべきは、なんといってもモデルの作成が驚くほど簡単なことです。例を見てみましょう。</p><p></p><p></p><p>結局、テストメソッドは自前で実装することになりました。混同行列は、クラスに定義されたデータの計算が得意ではないようですね。</p><p></p><p></p><p>最後に、scikit-learnのドキュメントをチェックしてみてください。すべての事例に<a href="http://scikit-learn.org/stable/auto_examples/" rel="nofollow" title="" class="ext-link">ステキな図表</a>がついていますね。ただ、ドキュメントを読めば分かりますが、ディシジョンツリーはかなり長くなる可能性があります。何千というルールが適用されることもあるので、よほどシンプルなケースでない限り図表化には向かないでしょう。</p><p></p>
