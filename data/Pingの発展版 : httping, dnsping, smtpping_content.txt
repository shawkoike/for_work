Advanced Ping: httping, dnsping, smtpping (2016-05-10) by Johannes Weber私はpingが大好きです！簡単に使えて、ネットワークが稼働しているかを直接明らかにできます。「Pingはセキュリティの欠陥ではない!(むしろ友達である)」、「Traceroute上級」の記事をご参照ください。少なくとも、外行きのping(trust(=信頼されるゾーン)からunstrust(=そうでないゾーン)へ)はセキュリティ上の心配なしに用いられるべきです。しかし、これらのuntrustからDMZへのICMPエコー・リクエストは多くの会社で拒否されているため、すべてのサーバが起動・稼働しているかをテストするのが困難になっています。私は、顧客のサイトのDMZファイアウォールの置き換えに取り組んでいました。当然ながら私は「すべてのサーバが適切に接続されているか(NAT)」「ファイアウォールが接続を許可しているか(ポリシー)」を(外部から)知ろうとしました。そこで私は、さまざまなレイヤーでの7つのpingツールを使い、(サーバだけでなく)サービスが稼働しているかどうかを明らかにすることができました。これらのツールは、HTTP, DNS, SMTP(ICMPエコー・リクエストの代わり)のセッションを生成するものです。素晴らしいですね！この投稿では、Linuxマシン上でのhttping, dnsping, smtppingのインストールと使用方法について示していきます。私のケースでは、キャプチャしたセッションからのWiresharkのスクリーンショットと同様に、Ubuntu server 14.04.4 LTSを利用しています。その名の通り、httpingはHTTPリクエストを送ります。スペルの中に”P”が一つしか含まれていないことの注意してください。このツールはGitHubから入手可能です。ここでもこのツールについての情報が得られます。インストールのプロセスは以下のようになります：(ただのsudo apt-get install httpingではhttpingの古いバージョンが得られてしまうので、お勧めしません。)基本的な機能としては、httping blog.webernetz.netというように、オプションとしてホスト名だけを必要とします。他にも多くのオプションが利用できて、SSL/TLSでのHTTPSもサポートしています。例：以下の画像の1枚目はcolor mode (-Y)、–threshold-red、–threshold-yellowパラメータ(私はこれを好みます)でのhttpingのスクリーンショットです。2,3枚目はWiresharkのスクリーンショットで、片方はhttpセッション(SYNパケットとHEADリクエスト、200 OKの返答がありますね)、もう片方はhttpsセッションでのものです。
カラーモードでのhttping

httpホストへのhttping

httpsホストへのhttpingDNSDiag toolkitの一部であるdnspingはGitHubから入手可能で、DNSクエリを送信するものです。インストールするには以下のコマンドを用います。:他に何もオプションをつけなければ、dnspingはデフォルトのDNSサーバ(/etc/resolv.conf)に対してホスト名についてのタイプAのクエリを送信します。しかし、DNSサーバ(-s SERVER)やクエリのタイプ(-t TYPE)に関するオプションも利用できます。Wiresharkでは、以下のように見えます。
dnsping Wireshark(DNSDiag kitに含まれるほかの2つのツール、dnseval.py と dnstraceroute.pyにも注目してみてください。)最後に、smtppingはテストメールを送信します。. デフォルトでは”無制限に”メールを送信してしまうので、-cオプションを使うのを忘れないように注意しましょう。こちらもGitHubで入手可能です。インストールのコマンドは以下の通りです。Wireshark, Cisco ESA, Thunderbird でのこれらのテストメールのスクリーンショットが以下です。スクリーンショットの説明をご参照ください：
もし送信者(-S mail@address.foo)が設定されていないと、メールのゲートウェイがメッセージをスパムと判定することがあります。Cisco ESA アプライアンスの例。

テストメールはThunderbirdではこう表示されます。

Wiresharkがsmtppingをキャプチャしたところ。 SYN, クリアテキストでのメール, FIN。

WiresharkのFollow TCP Stream。(1/2)

WiresharkのFollow TCP Stream。(2/2)私はこれらのツールにとても満足しています。これらは使いやすく、ネットワークやファイアウォールの設定を変えている間にサービスをモニタリングする助けになります。また、これらのツールは同時に「pingを拒否することがよいセキュリティのアプローチだ」と信じてやまないセキュリティ管理者に対するよい反論にもなるのです。それでは！
