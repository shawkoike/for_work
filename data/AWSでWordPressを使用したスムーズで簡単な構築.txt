<p><a href="https://cloudonaut.io/wordpress-on-aws-smooth-and-pain-free/" rel="nofollow" title="" class="ext-link">WordPress on AWS smooth and pain free</a>(2016-10-31) by <a href="https://twitter.com/andreaswittig" rel="nofollow" title="" class="ext-link">Andreas Wittig</a></p><p><a href="https://cloudonaut.io/amazon-web-services-in-action/" rel="nofollow" title="" class="ext-link">『Amazon Web Services in Action』</a>の著者。ソフトウェアエンジニア。AWSとDevOpsに重点的に取り組むフリーのコンサルタントでもある。</p><p>WordPressはクラウド・レディでもサーバレスでもないので、私はあまり好きではありません。このブログは<a href="https://aws.amazon.com/jp/cloudfront/" rel="nofollow" title="" class="ext-link">CloudFront</a>と<a href="https://aws.amazon.com/jp/s3/" rel="nofollow" title="" class="ext-link">S3</a>を使用し、<a href="https://hexo.io/" rel="nofollow" title="" class="ext-link">Hexo</a>で構築しています。しかし、なんと<a href="https://w3techs.com/technologies/history_overview/content_management/all/y" rel="nofollow" title="" class="ext-link">Webサイトの25％がWordPressを使って作成されているのです</a>。そこで、AWSでWordPressを構築する最も簡単な方法を説明します。フォールトトレランスとスケーラビリティを含んだ内容です。</p><p>次の図は、AWS上でフォールトトレラントかつスケーラブルなWordPress環境を構築する際のアーキテクチャを表しています。</p><p><img src="https://cloudonaut.io/images/2016/10/wordpress-overview.png" alt="WordPress on AWS"><br>
<em>注釈：Elastic File System（EFS）<br>
MySQL（マスター）<br>
MySQL（スタンバイ）<br>
WordPressを実行するEC2インスタンス<br>
ロードバランサ<br>
CDN</em></p><p>詳しく見ていきましょう。</p><p>WordPressは、MySQLのデータベースとディスク上のファイルという2つの異なるデータストレージを使用するPHPアプリケーションです。ファイルをディスク上に保存すると、EC2インスタンス群を使用してフォールトトレラントかつスケーラブルな方法でWordPressを実行する場合に問題が生じます。</p><p>次の例と図は、その問題点を表したものです。</p><p><img src="https://cloudonaut.io/images/2016/10/wordpress-stateful-server.gif" alt="WordPress stateful server"><br>
面倒なことに、全てのEC2インスタンスでファイルを同期させるか、マネージドサービスにファイルをアウトソースしなくてはいけません。</p><p>私は以前、AWSでWordPressを使う際に生じるこの問題を解決しようと試みました。<a href="https://cloudonaut.io/wordpress-on-aws-you-are-holding-it-wrong/" rel="nofollow" title="" class="ext-link">『AWSでWordPressを使用する：あなたの間違った使い方』</a>という記事に、解決策の詳細が載っています。</p><p>簡単に要約すると、以下のようなものです。</p><p>しかし、プラグインとテーマのインストール機能や、自動更新機能が使えないのは不便です。</p><p>Elastic File System（EFS）は2016年にAWSのサービスに追加されました。<br>
EFSは高可用性のスケーラブルなネットワークファイルシステムで、NFSプロトコルを使用してEC2インスタンスに接続できます。ファイルをアウトソースするには完璧な場所です。</p><p>次の図は、WordPressを実行する各EC2インスタンスが、どのようにEFSに接続してファイルを読み書きするかを表しています。ユーザがアップロードするものと、WordPressのファイルを区別する必要はありません。</p><p><img src="https://cloudonaut.io/images/2016/10/wordpress-efs-only.png" alt="WordPress with EFS"><br>
<em>注釈：Elastic File System（EFS）<br>
EC2インスタンス群</em></p><p>EC2インスタンスがEFSからファイルを読み込む際は毎回ネットワーク呼び出しが必要なので、ファイルのキャッシュが重要です。</p><p>特に<code>.php</code>ファイルの場合はそうです。WordPressはリクエストの度に、多くの<code>.php</code>ファイルにアクセスする必要があるからです。<a href="http://php.net/manual/en/book.opcache.php" rel="nofollow" title="" class="ext-link">OPcache</a>を使えば、すぐに解決できるでしょう。</p><p>同様に、静的ファイルのキャッシュも必要になります。WordPressのブログの訪問者は、それぞれ同じ<code>.css</code>ファイルや<code>.js</code>ファイルを読み込まなければいけないので、CloudFrontのようなCDNが最適です。</p><p>これらのサービスに基づいた、AWS上のWordPressのアーキテクチャ完成図は次のようになります。</p><p><img src="https://cloudonaut.io/images/2016/10/wordpress-overview.png" alt="WordPress on AWS"><br>
<em>注釈：Elastic File System（EFS）<br>
MySQL（マスター）<br>
MySQL（スタンバイ）<br>
WordPressを実行するEC2インスタンス<br>
ロードバランサ<br>
CDN</em></p><p>上記で説明したように、EFSを使用してAWSでWordPressを使いたいですか？ 私はCloudFormationのテンプレートを作成しました。次に挙げる特徴を含んだ、求められるクラウドインフラストラクチャの構築が数分で行えます。</p><p>AWSでWordPressを使うためのCloudFormationのテンプレートについて<a href="https://github.com/widdix/aws-cf-templates/tree/master/wordpress" rel="nofollow" title="" class="ext-link">詳しく知り</a>、数分でスタックをローンチしてみてください。</p><p>以下の書籍と記事をお薦めします。</p>
